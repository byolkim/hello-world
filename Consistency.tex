\documentclass{article}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{enumitem}
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}
\usepackage{titlesec}
\titleformat*{\section}{\normalfont\bfseries}
\titleformat*{\subsection}{\normalfont\bfseries}

\DeclareMathOperator*{\argmin}{arg min}
\DeclareMathOperator*{\supp}{supp}

\DeclareMathOperator{\Cov}{Cov}
\DeclareMathOperator{\Var}{Var}

\def\E{\mathbb{E}}
\def\P{\mathbb{P}}
\def\R{\mathbb{R}}

\def\fate{\boldsymbol{e}}
\def\fath{\boldsymbol{h}}
\def\fatu{\boldsymbol{u}}
\def\fatw{\boldsymbol{w}}
\def\fatx{\boldsymbol{x}}
\def\faty{\boldsymbol{y}}

\def\fatX{\boldsymbol{X}}
\def\fatY{\boldsymbol{Y}}

\def\fatdelta{\boldsymbol{\delta}}
\def\fattheta{\boldsymbol{\theta}}
\def\fatpsi{\boldsymbol{\psi}}

\def\fatDelta{\boldsymbol{\Delta}}

\newcommand{\indep}{\rotatebox[origin=c]{90}{$\models$}}

\newtheorem{cor}{Corollary}
\newtheorem*{thm}{Theorem}
\theoremstyle{definition}
\newtheorem{assumption}{Assumption}

\begin{document}
\section{}
Suppose we are interested in obtaining a de-biased estimator for a particular edge $\fattheta_{t_0}$.
We consider a three-stage estimation as follows.

\begin{enumerate}[label={\it Step \arabic*.}, wide=0pt]
\item
	\begin{equation}
	\hat\fattheta \in \argmin_{\fattheta}
	\underbrace{\ell_\text{KLIEP}(\fattheta; X, Y)}_{\mathcal{L}_1(\fattheta)} + \lambda\underbrace{\|\fattheta\|_1}_{\mathcal{R}(\fattheta)}.
	\end{equation}
\item
	\begin{equation}
	\hat\fatw \in \argmin_{\fatw}
	\underbrace{\tfrac{1}{2}\fatw^\top\mathcal{I}(\hat\fattheta; X, Y)\fatw-\fatw^\top\fate_{t_0}}_{\mathcal{L}_2(\fatw)} + \mu\underbrace{\|\fatw\|_1}_{\mathcal{R}(\fatw)}.
	\end{equation}
\item
	\[\tilde\fattheta\in\argmin_{\fattheta} \ell_\text{KLIEP}(\fattheta; X, Y)
	\quad\text{s.t.}\quad \fattheta_t=0
	\quad\text{whenever}\quad t\notin\supp\hat\fattheta\cup\supp\hat\fatw.\]
\end{enumerate}

\noindent We will consider two sparsity scenarios for $\fattheta^*$:

\begin{description}[font=\normalfont]
\item[1-E] $\fattheta^*$ is $d$-sparse, i.e.~$S=\supp\fattheta^*$ and $|S|=d$;
\item[1-W] $\fattheta^*\in B_q(r_1)=\{\fattheta : \sum_t |\fattheta_t|^q \leq r_1\}$ for some fixed $q\in [0,1]$ and $r_1>0$.
\end{description}

\noindent We will consider two sparsity scenarios for $\fatw^*$:

\begin{description}[font=\normalfont]
\item[2-E] $\fatw^*$ is $d$-sparse, i.e.~$S=\supp\fatw^*$ and $|S|=d$;
\item[2-W] $\fattheta^*\in B_q(r_2)=\{\fattheta : \sum_t |\fattheta_t|^q \leq r_2\}$ for some fixed $q\in [0,1]$ and $r_2>0$.
\end{description}

\noindent We make the following assumptions about our model.

\begin{assumption}[Correct Model]
The density ratio model is correct, i.e.~there exists $\fattheta^*$ such that
	\[p(\fatx)=r(\fatx;\fattheta^*)\,q(\fatx)\]
a.e.
\end{assumption}

\begin{assumption}[Minimum Eigenvalue]
	\[\lambda_{\min}[\mathcal{I}(\fattheta^*)]
	=\lambda_{\min}[\nabla^2\mathcal{L}_1(\fattheta^*)]
	=\lambda_{\min}[\nabla^2\log\hat N(\fattheta^*)]
	=\lambda_{\min}>0\]
with probability $1$.
\end{assumption}

\begin{assumption}[Smoothness of the Loss]
There exists $R_1>0$ such that whenever $\|\fattheta-\fattheta^*\|<R_1$,
	\[\max_t\left\|\left|\nabla_t\mathcal{I}(\fattheta)\right|\right\|
	=\max_t\left\|\left|\nabla_t\nabla^2\mathcal{L}_1(\fattheta)\right|\right\|
	=\max_t\left\|\left|\nabla_t\nabla^2\log\hat N(\fattheta)\right|\right\|
	\leq\lambda_{3,\max}<\infty\]
with probability $1$.
\end{assumption}

\noindent Assumption 3 implies, whenever $\|\fattheta-\fattheta^*\|<R_1$,
	\[\lambda_{\max}[\mathcal{I}(\fattheta)]
	=\lambda_{\max}[\nabla^2\mathcal{L}_1(\fattheta)]
	=\lambda_{\max}[\nabla^2\log\hat N(\fattheta)]
	=\lambda_{\max}<\infty\]
with probability $1$.

\begin{assumption}[Local Sub-Gaussianity]
There exists $R_2>0$ and $\sigma^2>0$ such that whenever $\|\fattheta-\fattheta^*\|<R_2$
	\[\E_q\left[\exp\Big(t(r(\fatx;\fattheta)-1)\Big)\right]\leq e^{-\sigma^2t^2/2} \quad\forall\,t\in\R\]
\end{assumption}

\noindent We will try to do without the following assumption:

\begin{assumption}[Incoherence]
	\[\max_{t\notin S_1} \|\mathcal{I}(\fattheta^*)_{tS}\mathcal{I}(\fattheta^*)_{SS}^{-1}\|_1<1-\alpha \quad\text{for some}\quad \alpha\in (0,1]\]
with probability $1$.
\end{assumption}

\section{}
We restate Negahban's results below for reference.
Consider a convex optimization problem of the form
	\[\hat\fattheta_{\lambda_n}\in\argmin_{\fattheta} \mathcal{L}(\fattheta; Z_1^n)+\lambda_n\mathcal{R}(\fattheta). \tag{$*$}\]
Suppose the loss function $\mathcal{L}$ and the regularizer $\mathcal{R}$ satisfies the following assumptions.

\begin{enumerate}[label=(G\arabic*), wide=0pt]
\item The regularizer $\mathcal{R}$ is a norm and is decomposable with respect to the subspace pair $(\mathcal{M},\bar{\mathcal{M}}^\perp)$, where $\mathcal{M}\subseteq\bar{\mathcal{M}}$.
\item The loss function $\mathcal{L}$ is convex and differentiable, and satisfies restricted strong convexity with curvature $\kappa_\mathcal{L}$ and tolerance $\tau_\mathcal{L}$.
\end{enumerate}

\begin{thm}[Negahban et al., 2012]
Under conditions (G1) and (G2), consider the problem ($*$) based on a strictly positive regularization constant $\lambda_n\geq 2\mathcal{R}^*(\nabla\mathcal{L}(\theta^*))$.
Then any optimal solution $\hat\theta_{\lambda_n}$ to the convex program ($*$) satisfies the bound
	\begin{equation}
	\|\hat\theta_{\lambda_n}-\theta^*\|^2
	\leq 9\frac{\lambda_n^2}{\kappa_\mathcal{L}^2}\Psi^2(\bar{\mathcal{M}})+\frac{\lambda_n}{\kappa_\mathcal{L}}\{2\tau_\mathcal{L}^2(\theta^*)+4\mathcal{R}(\theta^*_{\mathcal{M}^\perp})\}.
	\end{equation}
\end{thm}

\noindent
Let $S$ be any subset $S\subseteq\{1,\dots,m(m+1)/2\}$.
It is easy to see that $\mathcal{R}(\,\cdot\,)=\|\,\cdot\|_1$ is decomposable with respect to
	\begin{align*}
	\mathcal{M}(S)=\{\fattheta_s : \fattheta_t=0 \text{ for all } t\notin S\}
	&\quad\text{and}\quad
	\mathcal{M}^\perp(S)=\{\fattheta_t : \fattheta_t=0 \text{ for all } s\in S\}
	\intertext{or}
	\mathcal{M}(S)=\{\fatw_t : \fatw_t=0 \text{ for all } t\notin S\}
	&\quad\text{and}\quad
	\mathcal{M}^\perp(S)=\{\fatw_t : \fatw_t=0 \text{ for all } t\in S\}.
	\end{align*}
Also, $\mathcal{R}^*(\,\cdot\,)=\|\,\cdot\,\|_\infty$.

\section{Consistency of Step 1}
\begin{cor}
Suppose $\fattheta^*$ is $d$-sparse (1-E) and Assumptions 1 - 4 are satisfied.
Given the $\ell^1$-regularized KLIEP procedure (1) with regularization parameter satisfying
	\[\lambda_{n_p}=2\sqrt{2(2+\lambda_{\max})C}\cdot\sqrt{\frac{\log(m(m+1)/2)}{n_p}}\leq 2(2+\lambda_{\max})\min\{1,R_2\},\]
for some $C>1$, any optimal solution $\hat\fattheta$ satisfies the bounds
	\begin{equation}
	\|\hat\fattheta-\fattheta^*\|_2^2
	\leq\sqrt{\frac{d\log(m(m+1)/2)}{n_p}}\times\frac{4}{3}\frac{R_1^3\lambda_{3,\max}\sqrt{2(2+\lambda_{\max})C}}{\lambda_{\min}}\left[1+108\frac{\sqrt{2(2+\lambda_{\max})C}}{R_1^3\lambda_{3,\max}\lambda_{\min}}\sqrt{\frac{d\log(m(m+1)/2)}{n_p}}\right]
	\end{equation}
with probability at least
	\[1-\exp\left(-c_pn_p\lambda_{n_p}^2\right)-\exp\left(-c_qn_q\lambda_{n_p}^4+2\log(m(m+1))\right),\]
where $c_p>0$ and $c_q>0$ are constants depending on $C$ but independent of $n_p$, $n_q$ or $m$.
\end{cor}

\begin{proof}
Let $S=\supp\fattheta^*$, and define
	\[\mathcal{M}=\{\fattheta_s : \fattheta_t=0 \text{ for all } t\notin S\}
	\quad\text{and}\quad
	\mathcal{M}^\perp=\{\fattheta_t : \fattheta_t=0 \text{ for all } s\in S\}.\]
We have seen that (G1) is satisfied with respect to this subspace pair.
By Lemma 2, with $\lambda_{n_p}$ as given,
	\[\lambda_{n_p}
	\geq 2\mathcal{R}^*(\nabla\mathcal{L}_1(\fattheta^*))
	=2\|\nabla\mathcal{L}_1(\fattheta^*)\|_\infty\]
with probability at least
	\[1-\exp\left(-c_pn_p\lambda_{n_p}^2\right)-\exp\left(-c_qn_q\lambda_{n_p}^4+2\log(m(m+1))\right).\]
By Taylor's theorem and by Assumption 1,
	\[\fatdelta\mathcal{L}_1(\fatDelta,\fattheta^*)
	\geq\frac{1}{2}\fatDelta^\top\mathcal{I}(\fattheta^*)\fatDelta-\frac{1}{6}\max_{\|\fatDelta\|<R_1}\max_{t_1,t_2,t_3} |\nabla_{t_1}\nabla_{t_2}\nabla_{t_3}\mathcal{L}(\fattheta^*+\fatDelta)|\|\fatDelta\|^3
	\geq\frac{1}{2}\lambda_{\min}\|\fatDelta\|^2-\frac{1}{6}\lambda_{3,\max}R_1^3 \quad\forall\,\|\fatDelta\|\leq R_1.\]
Thus, $\mathcal{L}_1$ satisfies RSC with $\kappa_{\mathcal{L}_1}=\lambda_{\min}/2$ and $\tau_{\mathcal{L}_1}^2(\fattheta^*)=\lambda_{3,\max}R_1^3/6$.
Combine Lemma 2 from Liu et al., 2016 with Theorem from Negahban et al. 2012, and plug in $\kappa_{\mathcal{L}_1}$, $\tau_{\mathcal{L}_1}^2(\fattheta^*)$, and $\mathcal{R}(\fattheta^*_{\mathcal{M}^\perp})=0$ to obtain
	\[\|\hat\fattheta-\fattheta^*\|_2^2
	\leq 288\frac{(2+\lambda_{\max})C}{\lambda_{\min}^2}\frac{d\log(m(m+1)/2)}{n_p}+\frac{4}{3}\frac{R_1^3\lambda_{3,\max}\sqrt{2(2+\lambda_{\max})C}}{\lambda_{\min}}\sqrt{\frac{d\log(m(m+1)/2)}{n_p}}.\]
\end{proof}

\section{Consistency of Step 2}
Consider
	\[\fatw^* \in \argmin_{\fatw} \E_{X,Y}\underbrace{\left[\tfrac{1}{2}\fatw^\top\mathcal{I}(\fattheta^*)\fatw-\fatw^\top\fate_{t_0}\right]}_{\mathcal{L}_2^*(\fatw)}. \tag{2*}\]
Since $\mathcal{L}_2$ is quadratic in $\fatw$, $\fatdelta\mathcal{L}_2(\fath,\fatw^*)$ is exactly
	\[\fatdelta\mathcal{L}_2(\fath,\fatw^*)
	=\frac{1}{2}\fath^\top\mathcal{I}(\hat\fattheta)\fath
	\geq\frac{1}{2}\lambda_{\min}[\mathcal{I}(\hat\fattheta)]\|\fath\|^2.\]
Put $\hat\fatDelta=\hat\fattheta-\fattheta^*$.
With Weyl's inequality, Assumptions 2 and 3 imply
	\begin{align*}
	\lambda_{\min}[\mathcal{I}(\hat\fattheta)]
	&=\lambda_{\min}[\mathcal{I}(\fattheta^*+\hat\fatDelta)] \\
	&\geq\lambda_{\min}[\mathcal{I}(\fattheta^*)]-\sqrt{\frac{m(m+1)}{2}}\max_t\left\|\left|\nabla_t\mathcal{I}(\fattheta^*+\hat\fatDelta)\right|\right\|\left\|\hat\fatDelta\right\| \\
	&\geq\lambda_{\min}-\lambda_{3,\max}\sqrt{\frac{m(m+1)}{2}}\|\hat\fattheta-\fattheta^*\|
	\end{align*}
with probability $1$.
Thus, with (4) from Corollary 1,
	\[\fatdelta\mathcal{L}_2(\fath,\fatw^*)
	\geq\kappa_{\mathcal{L}_2}\|\fath\|^2-\Omega\left(\sqrt[4]{\frac{d(m(m+1)/2)^2\log(m(m+1)/2)}{n_p}}\right)\]
with the stated probability, where
	\[\kappa_{\mathcal{L}_2}=\frac{1}{2}\lambda_{\min}
	\quad\text{and}\quad
	\tau_{\mathcal{L}_2}^2=\sqrt{\frac{4}{3}\frac{R_1^3\lambda_{3,\max}\sqrt{2(2+\lambda_{\max})C}}{\lambda_{\min}}}.\]
Similarly to the extensions to generalized linear models made in Negahban et al.~(2012), $\mathcal{L}_2$ satisfies a form of RSC provided that the $P$-sample size scales as
	\[n_p=\Omega\Big(d(m(m+1)/2)^2\log(m(m+1)/2)\Big).\]
It remains to bound the gradient at $\fatw^*$
	\[\nabla\mathcal{L}_2(\fatw^*)=\mathcal{I}(\hat\fattheta)\fatw^*-\fate_{t_0}\]
in the max norm to characterize an appropriate $\mu$.
Write
	\[\mathcal{I}(\hat\fattheta)
	=\big(\mathcal{I}(\hat\fattheta)-\mathcal{I}(\fattheta^*)\big)+\big(\mathcal{I}(\fattheta^*)-\E_{X,Y}[\mathcal{I}(\fattheta^*)]\big)+\E_{X,Y}[\mathcal{I}(\fattheta^*)].\]

\subsection{Attempt 1}
\subsubsection{Bounding $\fatw^*$}
By definition of $\fatw^*$, $\fatw^*=\E_{X,Y}[\mathcal{I}(\fattheta^*)]^{-1}\fate_{t_0}$, so that
	\[\|\fatw^*\|_2
	=\|\E_{X,Y}[\mathcal{I}(\fattheta^*)]^{-1}\fate_{t_0}\|_2
	\leq\|\E_{X,Y}[\mathcal{I}(\fattheta^*)]^{-1}\|_2\|\fate_{t_0}\|_2
	=\frac{1}{\lambda_{\min}[\E_{X,Y}[\mathcal{I}(\fattheta^*)]]}.\]
$\rightarrow$ So, assume
	\[\lambda_{\min}[\E_{X,Y}[\mathcal{I}(\fattheta^*)]]>0.\]
(Note: Would it be better to replace Assumption 2 by this assumption + derive bounds for $\lambda-{\min}[\mathcal{I}(\fattheta^*)]$ in terms of this bound?)

\subsubsection{Bounding $\mathcal{I}(\fattheta^*)-\E_{X,Y}[\mathcal{I}(\fattheta^*)]$}
We need to bound
	\[\|\mathcal{I}(\fattheta^*)-\E_{X,Y}[\mathcal{I}(\fattheta^*)]\|_\infty,\]
where $\|\,\cdot\,\|_\infty$ denotes the element-wise max norm.
Observe that we may write
	\[\mathcal{I}(\fattheta)
	=\sum_{1\leq j<j'\leq n_q} \frac{1}{2}\left(\fatpsi(\faty^{(j)})-\fatpsi(\faty^{(j')})\right)\left(\fatpsi(\faty^{(j)})-\fatpsi(\faty^{(j')}\right)^\top\frac{\exp\left(\fattheta^\top\fatpsi(\faty^{(j)})\right)\exp\left(\fattheta^\top\fatpsi(\faty^{(j')})\right)}{\tilde N(\fattheta)^2}\]
where
	\[\tilde N(\fattheta)=\sum_{j=1}^{n_q} \exp\left(\fattheta^\top\fatpsi(\faty^{(j)})\right).\]
$\rightarrow$ Suppose $\faty\indep\faty'\sim Q$.
Assume the entries of the random matrix
	\[\frac{1}{2}\big(\fatpsi(\faty) - \fatpsi(\faty')\big)\big(\fatpsi(\faty) - \fatpsi(\faty')\big)^\top r(\faty;\fattheta) \,r(\faty';\fattheta) - \Var_p[\fatpsi(\faty)]\]
is sub-exponential with parameter $\sigma_\psi^2$ in some neighborhood of $\fattheta^*$, i.e. for all pair $(s,t)$,
	\[\E_q\left[\exp\left\{\alpha\fate_s^\top\left(\frac{1}{2}\big(\fatpsi(\faty) - \fatpsi(\faty')\big)\big(\fatpsi(\faty) - \fatpsi(\faty')\big)^\top r(\faty;\fattheta) \,r(\faty';\fattheta) - \Var_p[\fatpsi(\faty)]\right)\fate_t\right\}\right]
	\leq e^{\alpha^2\sigma_\psi^2/2} \quad\forall |\alpha|\leq 1/\sigma_\psi\]
in some neighborhood of $\fattheta^*$.
Then, for each $(s,t)$,
	\begin{align*}
	& \P\left\{\tfrac{1}{2}(\psi_s(y_s) - \psi_s(y_s'))(\psi_t(y_t) - \psi_t(y_t'))^\top r(\faty;\fattheta^*) \,r(\faty';\fattheta^*) - \Cov_p[\psi_s(y_s),\psi_t(y_t)]\geq t\right\} \\
	= & \P\left\{\exp\left(\alpha\big(\tfrac{1}{2}(\psi_s(y_s) - \psi_s(y_s'))(\psi_t(y_t) - \psi_t(y_t'))^\top r(\faty;\fattheta^*) \,r(\faty';\fattheta^*) - \Cov_p[\psi_s(y_s),\psi_t(y_t)]\big)\right)\geq e^{\alpha t}\right\} \\
	\leq & \E_q\left[\exp\left(\alpha\big(\tfrac{1}{2}(\psi_s(y_s) - \psi_s(y_s'))(\psi_t(y_t) - \psi_t(y_t'))^\top r(\faty;\fattheta^*) \,r(\faty';\fattheta^*) - \Cov_p[\psi_s(y_s),\psi_t(y_t)]\big)\right)\right]e^{-\alpha t} \\
	\leq & e^{-\alpha t+\alpha^2\sigma_\psi^2/2},
	\end{align*}
which is minimized by $\alpha=t/\sigma_\psi^2$.
So,
	\begin{align*}
	\P\left\{\tfrac{1}{2}(\psi_s(y_s) - \psi_s(y_s'))(\psi_t(y_t) - \psi_t(y_t'))^\top r(\faty;\fattheta^*) \,r(\faty';\fattheta^*) - \Cov_p[\psi_s(y_s),\psi_t(y_t)]\geq t\right\}
	&\leq e^{-t/2\sigma_\psi^2} \quad\forall\,t>0,
	\intertext{and hence,}
	\P\left\{\big|\tfrac{1}{2}(\psi_s(y_s) - \psi_s(y_s'))(\psi_t(y_t) - \psi_t(y_t'))^\top r(\faty;\fattheta^*) \,r(\faty';\fattheta^*) - \Cov_p[\psi_s(y_s),\psi_t(y_t)]\big|\geq t\right\}
	&\leq e^{-t/2\sigma_\psi^2} \quad\forall\,t>0,
	\end{align*}
Taking the union bound,
	\[\P\left\{\left\|\tfrac{1}{2}(\fatpsi(\faty) - \fatpsi(\faty'))(\fatpsi(\faty) - \fatpsi(\faty'))^\top r(\faty;\fattheta^*) \,r(\faty';\fattheta^*) - \Var_p[\fatpsi(\faty)]\right\|_\infty\geq t\right\}
	\leq \frac{n_q(n_q-1)}{2}e^{-t/2\sigma_\psi^2} \quad\forall\,t>0.\]
(Note: This is problematic, because the terms are no longer independent. I may need to come up with a different strategy.)

\subsubsection{Bounding $\mathcal{I}(\hat\fattheta)-\mathcal{I}(\fattheta^*)$}
Finally, we need to bound
	\[\|\mathcal{I}(\hat\fattheta)-\mathcal{I}(\fattheta^*)\|_\infty.\]
$\rightarrow$ Assume, with probability $1$, the function
	\[\fattheta\mapsto \left[\frac{\exp\left(\fattheta^\top\fatpsi(\faty^{(j)})\right)\exp\left(\fattheta^\top\fatpsi(\faty^{(j')})\right)}{\tilde N(\fattheta)^2}\right]_{1\leq j<j'\leq n_q}\]
is coordinate-wise $C_\text{Lips}$-Lipschitz in some neighborhood of $\fattheta^*$, i.e.
	\[\left|\frac{\exp\left(\fattheta^\top\fatpsi(\faty^{(j)})\right)\exp\left(\fattheta^\top\fatpsi(\faty^{(j')})\right)}{\tilde N(\fattheta)^2}-\frac{\exp\left(\fattheta^{*\top}\fatpsi(\faty^{(j)})\right)\exp\left(\fattheta^{*\top}\fatpsi(\faty^{(j')})\right)}{\tilde N(\fattheta^*)^2}\right|
	\leq C_\text{Lips}\,\|\fattheta-\fattheta^*\|
	\quad\forall\,1\leq j<j'\leq n_q.\]
(Most of this is probably unnecessary if I can figure out the previous step?)
\end{document}